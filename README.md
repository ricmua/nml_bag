

This Python package wraps and documents functionality for reading data from bag 
files generated by [ROS2][ros2]. Bag files (or "bags" for short) are the 
standard via which ROS 2 stores data to disk. For an introduction to bag files, 
please see the ROS2 documentation that explains 
[recording and playing back data][intro_to_bags].

The purpose of this package is to facilitate directly reading data from bag 
files that have been recorded by ROS.[^Note that 
reading data directly from bags is different from playing data back. The latter 
functionality is amply explained in the ROS2 documentation.]
The [ROS 2 bag design document][design_document] explains the motivation and 
approach to data storage, and the [rosbag2][rosbag2_package] package 
provides an official implementation (C++ and Python). However, documentation of 
the _currently available_ [rosbag2 API][rosbag2_api] is currently both scattered and limited, as are recommended best practices for working with bags. This 
package is intended as much to gather documentation about existing ROS2 
functionality and to illustrate its usage. This package is intended only to 
fill a temporary gap, and it is expected that later versions of ROS2 (Humble 
and beyond) will make it obsolete.


[intro_to_bags]: https://docs.ros.org/en/ros2_documentation/humble
                 /Tutorials/Ros2bag/Recording-And-Playing-Back-Data.html
[ros2]: https://docs.ros.org/en/ros2_documentation/humble/index.html
[design_document]: https://github.com/ros2/design/blob/ros2bags/articles
                   /rosbags.md#-pagetitle-
[rosbag2_package]: https://github.com/ros2/rosbag2#rosbag2
[rosbag2_api]: https://github.com/ros2/design/blob/ros2bags/articles
               /rosbags.md#rosbag-api

### Installation

The [rosbag2][rosbag2_package] package must be installed. This does not 
necessarily require that ROS2 must be [installed][ros2_installation].

[ros2_installation]: https://docs.ros.org/en/humble/Installation.html

With the rosbag2 package installed, no further steps are required, as long as 
the package is available on the Python path (e.g., via 
[PYTHONPATH][pythonpath]).

A ``setup.cfg`` file has been provided, to facilitate package installation via 
[setuptools][setuptools]. Package installation can be accomplished via the 
command:

```
pip install path/to/nml_bag
```

[setuptools]: https://setuptools.pypa.io/en/latest/userguide
              /quickstart.html#basic-use
[pythonpath]: https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPATH

### Quickstart / Usage

Basic usage of the package follows this pattern:

1. Initialize a ROS2 command prompt by [sourcing the ROS2 environment](https://docs.ros.org/en/galactic/Tutorials/Workspace/Creating-A-Workspace.html#source-ros-2-environment).
2. Import the package:
   ```python
   import nml_bag
   ```
3. Initialize a Reader object:
   ```python
   reader = nml_bag.Reader('path/to/bag.db3', topics=['topic_a', '/topic_b'])
   ```
4. Iterate through message records:
   ```
   for message_record in reader: print(message_record)
   ```
5. Alternatively, the ``records`` property will return all available message 
   records:
   ```
   records = reader.records
   ```

#### Example

A usage example is included in this package as ``example.py``. The example 
assumes the existence of a bag ``bag_test``, consisting of a single sqlite3 
file ``bag_test_0.db3``. For the purpose of this example, the bag file is 
assumed to contain a single topic ``test``, on which two string-type messages 
have been recorded.

Roughly following the quickstart outline, the code for reading the bag is:

```python
from pprint import pprint
import nml_bag
reader = nml_bag.Reader('path/to/bag_test_0.db3')
pprint(reader.records)
```

And the output is similar to:

```
[{'data': 'Hello World!',
  'time_ns': 1654207659885697659,
  'topic': 'test',
  'type': 'example_interfaces/msg/String'},
 {'data': 'Goodybye World!',
  'time_ns': 1654207659885798001,
  'topic': 'test',
  'type': 'example_interfaces/msg/String'}]
```

### A note about serialization and storage formats

By [default][rosbag2_serialization], ROS2 messages are serialized using the 
[Common Data Representation (CDR)][cdr] standard and stored using the 
[sqlite 3][sqlite] standard.

Note: Although the [sqlite3][sqlite3] package is part of the standard distribution of 
Python 3 -- and it can be used to interpret bag files -- it is recommended that 
the ROS2 API be used for decoding bag files wherever possible.


[rosbag2_serialization]: https://github.com/ros2
                         /rosbag2#storage-format-plugin-architecture
[sqlite]: https://en.wikipedia.org/wiki/SQLite
[cdr]: https://en.wikipedia.org/wiki/Common_Data_Representation
[sqlite3]: https://docs.python.org/3/library/sqlite3.html







